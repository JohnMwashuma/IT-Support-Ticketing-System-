/*
	Redactor v8.0.2
	Updated: August 18, 2012
	
	http://redactorjs.com/
	
	Copyright (c) 2009-2012, Imperavi Inc.
	License: http://redactorjs.com/license/
	
	Usage: $('#content').redactor();
*/
function invokeRedactor(e,t,n){switch(e="class"==n?"."+e:"#"+e,t){case"ticket":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"]});break;case"forum":jQuery(e).redactor({autoresize:!1,convertDivs:!1,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","video"]});break;case"solution":jQuery(e).redactor({autoresize:!0,convertDivs:!1,allowTagsInCodeSnippet:!0,tabindex:2,imageUpload:"/solutions_uploaded_images",clipboardImageUpload:"/solutions_uploaded_images/create_file",imageGetJson:"/solutions_uploaded_images"});break;case"cnt-reply":jQuery(e).redactor({focus:!0,convertDivs:!1,autoresize:!1,observeImages:!0,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"],execCommandCallback:function(){"undefined"!=typeof TICKET_DETAILS_DATA?"undefined"!=typeof TICKET_DETAILS_DATA.draft.clearingDraft&&TICKET_DETAILS_DATA.draft.clearingDraft?TICKET_DETAILS_DATA.draft.clearingDraft=!1:TICKET_DETAILS_DATA.draft.hasChanged=!0:isDirty=!0},keyupCallback:function(){"undefined"!=typeof TICKET_DETAILS_DATA?"undefined"!=typeof TICKET_DETAILS_DATA.draft.clearingDraft&&TICKET_DETAILS_DATA.draft.clearingDraft?TICKET_DETAILS_DATA.draft.clearingDraft=!1:(isDirty=!0,TICKET_DETAILS_DATA.draft.hasChanged=!0):isDirty=!0}});case"cnt-fwd":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"]});break;case"cnt-note":jQuery(e).redactor({focus:!0,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",clipboardImageUpload:"/tickets_uploaded_images/create_file",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"]});break;case"bulk-reply":jQuery(e).redactor({focus:!1,convertDivs:!1,observeImages:!0,autoresize:!1,imageUpload:"/tickets_uploaded_images",setFontSettings:!0,wrapFontSettings:Helpdesk.settings,allowTagsInCodeSnippet:!0,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link","image","removeFormat"]});break;case"signature":jQuery(e).redactor({focus:!1,convertDivs:!1,autoresize:!1,buttons:["bold","italic","underline","|","image","|","fontcolor","backcolor","|","link"]});default:jQuery(e).redactor({convertDivs:!1,autoresize:!1,setFontSettings:!0,wrapFontSettings:Helpdesk.settings,buttons:["bold","italic","underline","|","unorderedlist","orderedlist","|","fontcolor","backcolor","|","link"]})}}var _0xf6db=["(6(){11 49=24;11 14={50:6(8,10){5 10.58(8)&92},57:6(8,10){7(8.58!=12){5 8.58(10)&16}46{5 8.57(10)}},55:6(8,18,10,20){7(8===10){5 18<=20}7(14.29(8)&&14.29(10)){5 14.50(8,10)}7(14.29(8)&&!14.29(10)){5!14.55(10,20,8,18)}7(!14.57(8,10)){5 14.50(8,10)}7(8.47.85<=18){5 40}7(8.47[18]===10){5 0<=20}5 14.50(8.47[18],10)},29:6(61){5(61!=12?61.93==3:40)},81:6(41){11 62=0;88(41=41.59){62++}5 62}};11 4=49.4=(6(){6 4(2){24.2=2}4.34.31=6(){5 4.31(24.2)};4.34.37=6(){5 4.37(24.2)};4.34.38=6(){5 4.38(24.2)};4.34.45=6(){5 4.45(24.2)};4.34.44=6(){5 4.44(24.2)};4.34.52=6(25,26,23,22){5 4.52(24.2,25,26,23,22)};4.34.51=6(){5 4.51(24.2)};5 4})();7(49.35){4.67=43;4.31=6(2){11 9;5(9=2.35())&&(9.63!=12)&&(9.36!=12)};4.37=6(2){11 9;7(!((9=2.35())&&(9.36!=12))){5 12}5[9.36,9.97]};4.38=6(2){11 9;7(!((9=2.35())&&(9.63!=12))){5 12}5[9.63,9.91]};4.45=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[8,18]}5[10,20]};4.44=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[10,20]}5[8,18]};4.52=6(2,25,26,23,22){11 9=2.35();7(!9){5}7(23==12){23=25}7(22==12){22=26}7(9.60&&9.79){9.60(25,26);9.79(23,22)}46{54=2.15.56();54.106(25,26);54.107(23,22);71{9.73()}80(41){}9.98(54)}};4.51=6(2){71{11 9=2.35();7(!9){5}9.73()}80(41){}}}46 7(49.15.39){11 69=6(42,32,30){11 19,13,21,33,64;13=42.90('89');19=32.103();19.60(30);64=19.77();88(43){64.86(13,13.59);19.82(13);7(!(19.87((30?'66':'83'),32)>0&&(13.59!=12))){99}}7(19.87((30?'66':'83'),32)===-1&&13.84){19.74((30?'100':'78'),32);21=13.84;33=19.101.85}46{21=13.48;33=14.81(13)}13.48.72(13);5[21,33]};11 68=6(42,32,30,21,33){11 36,65,19,13,53;53=0;36=14.29(21)?21:21.47[33];65=14.29(21)?21.48:21;7(14.29(21)){53=33}13=42.90('89');65.86(13,36||12);19=42.76.75();19.82(13);13.48.72(13);32.74((30?'66':'78'),19);5 32[30?'105':'104']('102',53)};4.67=43;4.31=6(2){11 17;2.70();7(!2.15.39){5 40}17=2.15.39.56();5 17&&17.77().15===2.15};4.45=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,43)};4.44=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,40)};4.37=6(2){5 4.45(2)};4.38=6(2){5 4.44(2)};4.52=6(2,25,26,23,22){7(23==12){23=25}7(22==12){22=26}11 17=2.15.76.75();68(2.15,17,40,23,22);68(2.15,17,43,25,26);5 17.96()};4.51=6(2){5 2.15.39.95()}}46{4.67=40}}).94(24);","|","split","||win||Selection|return|function|if|n1|sel|n2|var|null|cursorNode|Dom|document||range|o1|cursor|o2|node|foco|focn|this|orgn|orgo|_ref|_ref2|isText|bStart|hasSelection|textRange|offset|prototype|getSelection|anchorNode|getOrigin|getFocus|selection|false|e|doc|true|getEnd|getStart|else|childNodes|parentNode|root|isPreceding|clearSelection|setSelection|textOffset|r|isCursorPreceding|createRange|contains|compareDocumentPosition|previousSibling|collapse|d|k|focusNode|parent|anchorParent|StartToStart|supported|moveBoundary|getBoundary|focus|try|removeChild|removeAllRanges|setEndPoint|createTextRange|body|parentElement|EndToEnd|extend|catch|getChildIndex|moveToElementText|StartToEnd|nextSibling|length|insertBefore|compareEndPoints|while|a|createElement|focusOffset|0x02|nodeType|call|empty|select|anchorOffset|addRange|break|EndToStart|text|character|duplicate|moveEnd|moveStart|setStart|setEnd","replace","","\\w+","\\b","g"];eval(function(e,t,n,i,r,o){if(r=function(e){return e},!_0xf6db[5][_0xf6db[4]](/^/,String)){for(;n--;)o[n]=i[n]||n;i=[function(e){return o[e]}],r=function(){return _0xf6db[6]},n=1}for(;n--;)i[n]&&(e=e[_0xf6db[4]](new RegExp(_0xf6db[7]+r(n)+_0xf6db[7],_0xf6db[8]),i[n]));return e}(_0xf6db[0],10,108,_0xf6db[3][_0xf6db[2]](_0xf6db[1]),0,{}));var codeEditor_lang={html:"Html",css:"Css",js:"JavaScript",sass:"Sass",xml:"Xml",ruby:"Ruby",php:"PHP",java:"Java",csharp:"C#",cpp:"C++",objc:"Obj C",perl:"Perl",python:"Python",vbnet:"VB",sql:"SQL",text:"Generic Language"};if("undefined"==typeof RELANG)var RELANG={};var isMacintosh=navigator.appVersion.indexOf("Macintosh")>-1,ctrlkeyname=isMacintosh?"⌘":"Ctrl-",shiftkeyname=isMacintosh?"⇧":"Shift-",altkeyname=isMacintosh?"-Alt-":"Alt-",RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold ("+ctrlkeyname+"B)",italic:"Italic ("+ctrlkeyname+"I)",fontcolor:"Font Color",fontname:"Font",fontsize:"Font Size",backcolor:"Back Color",unorderedlist:"Unordered List ("+ctrlkeyname+shiftkeyname+"7)",orderedlist:"Ordered List ("+ctrlkeyname+shiftkeyname+"8)",outdent:"Outdent ("+shiftkeyname+"Tab)",indent:"Indent (Tab)",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image URL",text:"Text",mailto:"Email",web:"URL",video_html_code:"Enter the video embed code, copied from popular websites like YouTube, Vimeo etc. here",file:"Insert File...",upload:"Upload",download:"Download",choose:"Select Existing",choose_text:"Showing recent 20 images",or_choose:"Or choose",drop_file_here:"...or Drop a file from your computer here",align_left:"Align Left ("+ctrlkeyname+shiftkeyname+"L)",align_center:"Align Center ("+ctrlkeyname+shiftkeyname+"E)",align_right:"Align Right ("+ctrlkeyname+shiftkeyname+"R)",align_justify:"Justify ("+ctrlkeyname+shiftkeyname+"J)",horizontalrule:"Insert Horizontal Rule",deleted:"Strikethrough",underline:"Underline ("+ctrlkeyname+"U)",anchor:"Anchor",link_new_tab:"Open link in new tab",removeFormat:"Remove formatting ("+ctrlkeyname+"\\)",invalid_image_file:"Error occurred while uploading",confirm_remove_format_for_entire_content:"Converting the entire content to plain text will remove formatting and inserted items. Are you sure you want to continue?",codeEditor:"Code Snippet",codeEditor_html:"Enter code snippet and select language",label_lang:"Language : ",show_quoted_text:"Show Quoted text"},DEFAULT_LANG=jQuery.extend({},RLANG),uploaded_img_placeholder="undefined"==typeof FILLER_IMAGES?"/images/animated/image_upload_placeholder.gif":FILLER_IMAGES.imageLoading;!function(e){var t=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML};jQuery.fn.redactor=function(t){return this.each(function(){var i=e(this),r=i.data("redactor");r||i.data("redactor",r=new n(this,t))})};var n=function(t,n){this.redactor_copy_content,this.specialPaste=!1,this.textPaste=!1,this.undoDisable=!1,this.$el=e(t),this.cursorPlacementDelay=null,this.dataURI="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",this.imgTag=e("<img id='cursor' width='0' height='0' rel='cursor' src='"+this.dataURI+"'/>"),this.storedRange="",this.paste_supported_browser=1==e.browser.mozilla&&-1!=navigator.appVersion.indexOf("Win")||e.browser.webkit&&!/chrome/.test(navigator.userAgent.toLowerCase()),this.buildLangSelector(),"undefined"!=typeof n&&"undefined"!=typeof n.lang&&"en"!==n.lang&&"undefined"!=typeof RELANG[n.lang]&&(RLANG=RELANG[n.lang]),RLANG=e.extend(DEFAULT_LANG,RLANG),this.opts=e.extend({lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,focus:!1,autoresize:!0,fixed:!1,source:!0,mobile:!0,air:!1,wym:!1,convertLinks:!0,convertDivs:!0,autosave:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,clipboardImageUpload:!1,imageLoadingCallback:!1,imageLoadedCallback:!1,fileUpload:!1,fileUploadCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["code","span","div","a","p","pre","hr","br","b","strong","i","em","del","strike","s","u","blockquote","q","img","video","audio","iframe","embed","object","param","mark","cite","small","big","ul","ol","li","dl","dt","dd","abbr","acronym","address","dfn","sup","sub","kbd","ins","samp","tt","details","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6","canvas","figure","figcaption","output","section","summary","time"],toolbarExternal:!1,buttonsCustom:{},buttonsAdd:[],buttons:["formatting","fontname","fontsize","fontcolor","backcolor","bold","italic","underline","deleted","|","alignleft","aligncenter","alignright","justify","|","unorderedlist","orderedlist","indent","outdent","|","link","table","image","video","file","codeEditor","horizontalrule","|","removeFormat","|","html"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",s:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000","#808080","#00CCFF","#0000FF","#3366FF","#666699","#FF0000","#339966","#800080","#33CCCC","#008080","#FF9900"],fontnames:["Arial","Verdana","Helvetica","Helvetica Neue","Arial Black","Impact","Tahoma","Trebuchet MS","Terminal","Courier New","Comic Sans MS","Andale Mono","Georgia","Book Antiqua","Times New Roman","Symbol","Webdings","Windings"],fontsizes:[1,2,3,4,5],fontsize_levels:{1:10,2:13,3:16,4:18,5:24,6:32},fontsize_levels_reverse:{"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6},fontsize_naming:["Tiny","Small","Medium","Large","Huge"],allEmptyHtml:"<p><br /></p>\r\n",mozillaEmptyHtml:"<p>&nbsp;</p>\r\n",buffer:!1,visual:!0,setFontSettings:!1,wrapFontSettings:{"font-family":"'Helvetica Neue', Helvetica, Arial, sans-serif","font-size":"13px"},span_cleanup_properties:["color","font-family","font-size","font-weight"],allowTagsInCodeSnippet:!1,modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data">'+'<label for="redactor_filename">Name (optional)</label>'+'<input type="text" id="redactor_filename" class="redactor_input" />'+'<div class="mt7">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+"</form>",modal_image_edit:String()+'<label for="redactor_file_alt">'+RLANG.title+"</label>"+'<input id="redactor_file_alt" class="redactor_input" />'+'<label for="redactor_file_link">'+RLANG.link+"</label>"+'<input id="redactor_file_link" class="redactor_input" />'+'<label for="redactor_form_image_align">'+RLANG.image_position+"</label>"+'<select id="redactor_form_image_align">'+'<option value="none">'+RLANG.none+"</option>"+'<option value="left">'+RLANG.left+"</option>"+'<option value="right">'+RLANG.right+"</option>"+"</select>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" class="btn" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+"</a>"+'<span class="redactor_btns_box">'+'<a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+'<input type="button" class="btn btn-primary" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" />'+"</span>"+"</div>",modal_image:String()+'<div id="redactor_tabs">'+'<a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+"</a>"+'<a href="javascript:void(null);">'+RLANG.choose+"</a>"+'<a href="javascript:void(null);">'+RLANG.link+"</a>"+'<div id="redactor_image_choose_help_text">'+RLANG.choose_text+"</div>"+"</div>"+'<form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">'+'<div id="redactor_tab1" class="redactor_tab">'+'<div class="custom-file-upload">'+'<div class="file-upload">'+'<span class="file-upload-text">Select a file to upload</span>'+"</div>"+'<input type="file" id="redactor_file" name="image[uploaded_data]" accept="image/*" />'+"</div>"+"</div>"+'<div id="redactor_tab2" class="redactor_tab" style="display: none;">'+'<div id="redactor_image_box"></div>'+"</div>"+"</form>"+'<div id="redactor_tab3" class="redactor_tab" style="display: none;">'+'<label for="redactor_file_link">'+RLANG.image_web_link+"</label>"+'<input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />'+"</div>"+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<input type="button" class="btn" name="'+RLANG.cancel+'" id="redactor_btn_modal_close" value="'+RLANG.cancel+'" />'+'<input type="button" class="btn btn-primary" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" />'+"</span>"+"</div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action="">'+'<div id="redactor_tabs">'+'<a href="javascript:void(null);" class="redactor_tabs_act">URL</a>'+'<a href="javascript:void(null);">Email</a>'+'<a href="javascript:void(null);">'+RLANG.anchor+"</a>"+"</div>"+'<input type="hidden" id="redactor_tab_selected" value="1" />'+'<div class="redactor_tab" id="redactor_tab1">'+'<label for="redactor_link_url">URL</label><input id="redactor_link_url" class="redactor_input" />'+'<label for="redactor_link_url_text">'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" />'+'<label for="redactor_link_blank"><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+"</label>"+"</div>"+'<div class="redactor_tab" id="redactor_tab2" style="display: none;">'+'<label for="redactor_link_mailto">Email</label><input id="redactor_link_mailto" class="redactor_input" />'+'<label for="redactor_link_mailto_text">'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />'+"</div>"+'<div class="redactor_tab" id="redactor_tab3" style="display: none;">'+'<label for="redactor_link_anchor">'+RLANG.anchor+'</label><input class="redactor_input" id="redactor_link_anchor"  />'+'<label for="redactor_link_anchor_text">'+RLANG.text+'</label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />'+"</div>"+"</form>"+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<input type="button" class="btn" name="'+RLANG.cancel+'" id="redactor_btn_modal_close" value="'+RLANG.cancel+'" />'+'<input type="button" class="btn btn-primary" id="redactor_insert_link_btn" value="'+RLANG.insert+'" />'+"</span>"+"</div>",modal_video:String()+'<form id="redactorInsertVideoForm">'+'<label for="redactor_insert_video_area">'+RLANG.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+'<input type="button" class="btn btn-primary" id="redactor_insert_video_btn" value="'+RLANG.insert+'" />'+"</span>"+"</div>",modal_table:String()+'<label for="redactor_table_rows">'+RLANG.rows+"</label>"+'<input size="5" value="2" id="redactor_table_rows" />'+'<label for="redactor_table_columns">'+RLANG.columns+"</label>"+'<input size="5" value="3" id="redactor_table_columns" />'+'<div id="redactor_modal_footer">'+'<span class="redactor_btns_box">'+'<a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>"+'<input type="button" class="btn btn-primary" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" />'+"</span>"+"</div>",modal_codeEditor:String()+'<form id="redactorInsertCodeForm" class="redactorInsertCode" data-overlay-event=false >'+'<label for="redactor_insert_text_area">'+RLANG.codeEditor_html+"</label>"+'<div class="redactorInsertCode_dropdown pull-right">'+'<div class="vertical-alignment m6">'+RLANG.label_lang+"</div>"+RLANG.lang_selector+"</div>"+'<textarea id="redactor_insert_text_area" style="width: 99%; height: 250px;"></textarea>'+'<span style="color: #858585;">Note: Code highlighting will be applied on articles published on your portal.</span>'+"</form>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" class="btn" id="redactor_code_delete_btn" style="color: #000;">'+RLANG._delete+"</a>"+'<span class="redactor_btns_box">'+'<a href="javascript:void(null);" class="btn" id="redactor_btn_modal_close">'+RLANG.cancel+"</a>  "+'<input type="button" class="btn btn-primary" id="redactor_insert_code_btn" value="'+RLANG.save+'" />'+"</span>"+"</div>",toolbar:{html:{title:RLANG.html,func:"toggle"},codeEditor:{title:RLANG.codeEditor,className:"addcode",func:"showCodeEditor"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},fontname:{title:RLANG.fontname,func:"showCurrentFont"},fontsize:{title:RLANG.fontsize,className:"fontSize_dropdown",func:"showCurrentFont"},removeFormat:{title:RLANG.removeFormat,func:"buildremoveFormat"},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"toggleTableOptions",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator",className:"table_optional"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove",className:"table_optional"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow",className:"table_optional"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft",className:"table_optional"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight",className:"table_optional"},separator_drop2:{name:"separator",className:"table_optional"},add_head:{title:RLANG.add_head,func:"addHead",className:"table_optional"},delete_head:{title:RLANG.delete_head,func:"deleteHead",className:"table_optional"},separator_drop3:{name:"separator",className:"table_optional"},delete_column:{title:RLANG.delete_column,func:"deleteColumn",className:"table_optional"},delete_row:{title:RLANG.delete_row,func:"deleteRow",className:"table_optional"},delete_table:{title:RLANG.delete_table,func:"deleteTable",className:"table_optional"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,titleText:"("+ctrlkeyname+"K)",func:"showLink"},unlink:{title:RLANG.unlink,titleText:"("+ctrlkeyname+shiftkeyname+"K)",exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},n,this.$el.data()),this.dropdowns=[],this.init()};n.prototype={init:function(){var t=["unorderedlist","orderedlist"];if(1==e.browser.opera)for(var n=0;n<t.length;n++){var i=this.opts.buttons.indexOf(t[n]);i>-1&&this.opts.buttons.splice(i,1)}if(e.event.props.push("clipboardData"),this.height=this.$el.css("height"),this.width=this.$el.css("width"),this.opts.mobile===!1&&this.isMobile())return this.build(!0),!1;if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(this.opts.toolbar!==!1){if(this.opts.source===!1){var i=this.opts.buttons.indexOf("html"),r=this.opts.buttons[i+1];this.opts.buttons.splice(i,1),"undefined"!=typeof r&&"|"===r&&this.opts.buttons.splice(i,1)}e.extend(this.opts.toolbar,this.opts.buttonsCustom),e.each(this.opts.buttonsAdd,e.proxy(function(e,t){this.opts.buttons.push(t)},this))}if(this.build(),this.enableAir(),this.buildToolbar(),this.opts.activeButtons!==!1&&this.opts.toolbar!==!1){var o=e.proxy(function(){this.observeFormatting()},this);this.$editor.click(o).keyup(o).keydown(o),this.$toolbar.click(o)}var s=e("body").find("[rel=tmpClipboard]");s.attr("contenteditable","true"),s.css("width","100px"),s.css("height","10px"),s.css("opacity","0"),s.css("overflow","hidden"),this.isMobile(!0)===!1&&(this.cleanStyleAttr(),1==e.browser.msie&&e.browser.msie&&parseInt(e.browser.version,10)<=10&&this.$editor.bind("beforepaste",e.proxy(function(){this.paste_selection_modification(s)},this)),this.$editor.bind("paste",e.proxy(function(t){if(this.setCursorPosition(),this.specialPaste)this.specialPaste=!1;else if(this.paste_supported_browser){var n=t.clipboardData.getData("text/plain");0==n.length&&this.opts.clipboardImageUpload!==!1?e(this).pasteImage(t):this.paste_selection_modification(s)}else if(e.browser.msie&&parseInt(e.browser.version,10)>10&&void 0!=window.clipboardData){var n=window.clipboardData.getData("Text");void 0!=n&&n.length>0?this.paste_selection_modification(s):this.opts.clipboardImageUpload!==!1&&e(this).pasteImage(t)}else{var n="";n=t.clipboardData.getData("text/html"),0==n.length&&(n=t.clipboardData.getData("text/plain"),this.textPaste=!0),0==n.length&&this.opts.clipboardImageUpload!==!1?(this.textPaste=!1,e(this).pasteImage(t)):(t.preventDefault(),this.pasteCleanUp(n))}this.saveScroll=this.opts.autoresize===!0?document.body.scrollTop:this.$editor.scrollTop()},this)),e.browser.msie||e.browser.mozilla||this.$editor.bind("drop",e.proxy(function(t){t.preventDefault(),this.focusOnCursor(),e(this).pasteImage(t)},this))),this.keyup(),this.keydown(),this.bindclick(),this.bindCustomEvent(),e(this).removeCursorImage(this),this.opts.autosave!==!1&&this.autoSave(),this.observeImages(),this.observeTables(),this.observeCode(),e.browser.mozilla,this.opts.focus&&this.focusOnCursor(),this.opts.fixed&&(this.observeScroll(),e(document).scroll(e.proxy(this.observeScroll,this))),"function"==typeof this.opts.callback&&this.opts.callback(this);var a=this;this.inputEventAvailable()&&this.$editor.on("input",function(){a.syncCode()}),this.$editor.on("drop",function(){a.inputEventAvailable()||setTimeout(function(){a.syncCode()},1)}),this.$editor.on("blur",function(){a.syncCode(),a.$el.is(":hidden")&&a.insertCaretImage(),e(this).parent().removeClass("redactor_focus")}),this.$editor.on("focus",function(){e(this).parent().addClass("redactor_focus")}),this.$el.data("quotedTextarea")?(e(this).quotedtext(this),this.hasQuotedText=!0):this.hasQuotedText=!1},setCursorPosition:function(){if(this.$editor.find("[rel='cursor']").get(0)&&(e.browser.mozilla&&this.$editor.find("[rel='cursor']").removeAttr("style"),this.removeContent()),e.browser.mozilla||this.imgTag.css({display:"none"}),window.getSelection){var t=window.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0),i=document.createRange();i.setStart(t.focusNode,n.endOffset),this.storedRange=i}}},removeContent:function(){var e=this.$editor.find("[rel='cursor']").get(0);if(document.createRange&&e){var t=document.createRange();return t.selectNode(e),t.deleteContents(),!0}return!1},focusOnCursor:function(){var t=this.$editor.find("[rel='cursor']");if(t[0]){var n=document.createRange();n.selectNode(t[0]),this.getSelection().removeAllRanges(),this.getSelection().addRange(n),this.getSelection().collapseToEnd(),e.browser.mozilla&&this.$editor.focus()}else this.$editor.focus()},deleteCursor:function(){this.removeContent()&&this.syncCode()},addNoneStyleForCursor:function(){this.$editor.find("[rel='cursor']").get(0)&&(this.$editor.find("[rel='cursor']").css({display:"none"}),this.syncCode())},insertCaretImage:function(){this.storedRange&&this.storedRange.insertNode(this.imgTag[0])},removeTagOnLiquid:function(e){var e=this.$editor.html(),t=e.replace(/\{[^{]*}/g,this.replaceLiquidHtml).replace(/\{[^}]*}/g,this.replaceLiquidHtml).replace(/\{\%.*?\%\}|\{\{.*?\}\}?/gi,this.replaceLiquidHtml);return t},replaceLiquidHtml:function(e){return e.replace(/(<([^>]+)>)/gi,"")},insertOnCursorPosition:function(t,n){var i=this.getSelection(),r=i.toString?i.toString():i.text;""==r&&this.focusOnCursor(),this.execCommand(t,n),e.event.trigger({type:"textInserted",message:"success",time:new Date})},wrapElementWithFont:function(t){var n=e("<div />"),i=e("<div />");return i.css(this.opts.wrapFontSettings),i.html(t),n.append(i),n.html()},changesInTextarea:function(){var e=this.$editor.html();this.opts.allowTagsInCodeSnippet||(e=this.removeTagOnLiquid(e)),void 0!=this.$el.data("wrapFontFamily")&&this.$el.data("wrapFontFamily")&&(e=this.wrapElementWithFont(e)),this.$el.val(e)},removeCursorImage:function(){if(this.$el.is(":hidden")){var e=this.$el.data("removeCursor");void 0==e||e?this.deleteCursor():jQuery.browser.mozilla&&this.$el.data("redactor").addNoneStyleForCursor(),this.changesInTextarea()}},shortcuts:function(e,t,n){e.preventDefault(),"removeFormat"==t?this.buildremoveFormat():"formatblock"==t?this.execCommand(t,n):"link"==t?this.showLink():this.execCommand(t,!1)},paste_selection_modification:function(t){this.saveSelection();var n=this.getSelection();n.removeAllRanges();var i=document.createRange();i.selectNodeContents(t.get(0)),n.addRange(i),setTimeout(e.proxy(function(){var e=t.html();t.html(""),this.restoreSelection(),this.pasteCleanUp(e)},this),1)},recursive_find:function(t){var n=this;t.contents().each(function(){e(this).get(0).isEqualNode(n.savedSel[0])&&(n.savedSel[0]=e(this).get(0)),e(this).get(0).isEqualNode(n.savedSelObj[0])&&(n.savedSelObj[0]=e(this).get(0)),n.recursive_find(e(this))}),t.find("*").each(function(){e(this).get(0).isEqualNode(n.savedSel[0])&&(n.savedSel[0]=e(this).get(0)),e(this).get(0).isEqualNode(n.savedSelObj[0])&&(n.savedSelObj[0]=e(this).get(0)),n.recursive_find(e(this))})},bindclick:function(){this.$editor.click(e.proxy(function(){this.setCursorPosition()},this)),e.browser.mozilla&&this.$editor.dblclick(e.proxy(function(){this.$editor.find("[rel='cursor']").css({display:"none"})},this))},bindCustomEvent:function(){this.$editor.on("textInserted",e.proxy(function(){this.setCursorPosition()},this))},keyup:function(){this.$editor.keyup(e.proxy(function(t){var n=t.keyCode||t.which;return 40===n?(clearTimeout(this.cursorPlacementDelay),this.cursorPlacementDelay=setTimeout(e.proxy(function(){this.setCursorPosition()},this),500)):this.setCursorPosition(),"function"==typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,t),8===n||46===n?(this.observeImages(),this.formatEmpty(t)):13!==n||t.shiftKey||t.ctrlKey||t.metaKey?(this.inputEventAvailable()||this.syncCode(),void 0):this.formatNewLine(t)},this))},keydown:function(){this.$editor.keydown(e.proxy(function(t){var n=t.keyCode||t.which,i=this.getParentNode(),r=!1,o=t.ctrlKey||t.metaKey,s=t.shiftKey,a=t.altKey;if(i&&"PRE"===e(i).get(0).tagName&&(r=!0),this.$editor.find("[rel='cursor']").get(0)&&this.removeContent(),"function"==typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,t),!a&&o&&(90===n?t.shiftKey?this.shortcuts(t,"redo"):this.shortcuts(t,"undo"):s?82===n?this.shortcuts(t,"JustifyRight"):76===n?this.shortcuts(t,"JustifyLeft"):69===n?this.shortcuts(t,"JustifyCenter"):74===n?this.shortcuts(t,"justifyfull"):55===n?this.shortcuts(t,"insertunorderedlist"):56===n?this.shortcuts(t,"insertorderedlist"):75===n?this.shortcuts(t,"unlink"):86===n&&(this.specialPaste=!0):220===n?this.shortcuts(t,"removeFormat"):66===n?this.shortcuts(t,"bold"):73===n?this.shortcuts(t,"italic"):76===n||(72===n?this.shortcuts(t,"subscript"):85===n?this.shortcuts(t,"underline"):37===n?isMacintosh&&e.browser.mozilla&&(t.preventDefault(),this.getSelection().modify("move","backward","lineboundary")):75===n&&this.shortcuts(t,"link"))),o||90===n||(this.opts.buffer=!1),r===!0&&13===n&&(t.preventDefault(),this.insertNodeAtCaret(document.createTextNode("\r\n"))),t.shiftKey||9!==n)t.shiftKey&&9===n&&this.shortcuts(t,"outdent");else if(e(this.getCurrentNode()).parents("table").length)t.preventDefault();else{if(r!==!1)return t.preventDefault(),this.insertNodeAtCaret(this.document.createTextNode("	")),this.syncCode(),!1;t.preventDefault()}return e.browser.webkit&&-1===navigator.userAgent.indexOf("Chrome")?this.safariShiftKeyEnter(t,n):void 0
},this))},build:function(t){if(t!==!0){this.$box=e('<div class="redactor_box"></div>'),this.opts.air&&(this.air=e('<div class="redactor_air" style="display: none;"></div>')),this.textareamode=!0,"TEXTAREA"===this.$el.get(0).tagName?this.$editor=e("<div></div>"):(this.textareamode=!1,this.$editor=this.$el,this.$el=e('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height)),this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),this.opts.wym===!0&&this.$editor.addClass("redactor_editor_wym"),this.opts.autoresize===!1&&this.$editor.css("height",this.height),this.opts.setFontSettings&&this.$editor.css(this.opts.wrapFontSettings),this.$el.hide();var n="";this.textareamode?(n=this.$el.val(),this.$box.insertAfter(this.$el).append(this.$editor).append(this.$el)):(n=this.$editor.html(),this.$box.insertAfter(this.$editor).append(this.$el).append(this.$editor)),e("body").append('<div rel="tmpClipboard" />'),e('<div rel="getPasteImage" contenteditable="true" style="width:50px;height:0px; overflow: hidden;">').insertBefore(this.$editor),n=this.paragraphy(n),this.$editor.html(n),this.textareamode===!1&&this.syncCode()}else if("TEXTAREA"!==this.$el.get(0).tagName){var n=this.$el.val(),i=e('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(n);this.$el.hide(),this.$el.after(i)}},enableAir:function(){return this.opts.air===!1?!1:(this.air.hide(),this.$editor.bind("textselect",e.proxy(function(e){this.showAir(e)},this)),this.$editor.bind("textunselect",e.proxy(function(){this.air.hide()},this)),void 0)},isNotEmpty:function(){this.deleteCursor();var t,n=["img","iframe","object","embed"];t=this.$el.is(":visible")?e("<div>").html(this.$el.val()):this.$editor;for(var i=0;i<n.length;i++)if(0!=t.find(n[i]).length)return!0;return""!==t.text().trim()},showAir:function(t){e(".redactor_air").hide();var n=this.air.innerWidth(),i=t.clientX;e(document).width()<i+n&&(i-=n),this.air.css({left:i+"px",top:t.clientY+e(document).scrollTop()+14+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html()),this.$el.trigger("redactor:sync")},setCode:function(e){this.$editor.html(e).focus(),this.syncCode()},getCode:function(){return this.opts.visual?this.$editor.html():this.$el.val()},insertHtml:function(e){this.execCommand("inserthtml",e),this.observeImages()},destroy:function(){var t=this.getCode();this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(t).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(t).show()),this.opts.toolbarExternal&&e(this.opts.toolbarExternal).empty(),e(".redactor_air").remove();for(var n=0;n<this.dropdowns.length;n++)this.dropdowns[n].remove(),delete this.dropdowns[n];this.hasQuotedText&&this.$quoted.destroy()},observeFormatting:function(){var t=this.getCurrentNode();this.inactiveAllButtons(),e.each(this.opts.activeButtonsStates,e.proxy(function(n,i){0!=e(t).closest(n,this.$editor.get()[0]).length&&this.setBtnActive(i)},this));var n=e(t).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if("undefined"!=typeof n[0]&&"undefined"!=typeof n[0].elem&&0!=e(n[0].elem).size()){var i=e(n[0].elem).css("text-align");switch(i){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft")}}},showCurrentFont:function(){var t=this.getParentNode();e.browser.opera||(e(".redactor_font_link").find("span").remove(),this.observeFontStyle(t,"font-family"),this.observeFontStyle(t,"font-size"))},observeFontStyle:function(t,n){var i=e(t).css(n)||this.$editor.css(n);i=i.split(",")[0],"font-size"==n?(e.browser.msie&&(i=i.replace("px","").split(".")[0]+"px"),element=e('[rel="'+this.opts.fontsize_levels_reverse[i]+'"].redactor_font_link')):element=e('[rel="'+i+'"].redactor_font_link'),element.length&&element.html("<span class='icon ticksymbol'></span>"+element.html())},observeImages:function(){return this.opts.observeImages===!1?!1:(this.$editor.find("img").each(e.proxy(function(t,n){e.browser.msie&&e(n).attr("unselectable","on"),"cursor"!=e(n).attr("id")&&this.resizeImage(n)},this)),void 0)},observeTables:function(){this.$editor.find("table").click(e.proxy(this.tableObserver,this))},observeScroll:function(){var t=e(document).scrollTop(),n=this.$box.offset().top;t>n?(this.fixed=!0,this.$toolbar.css({position:"fixed",width:"100%",zIndex:100})):(this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1}))},setBuffer:function(){this.saveSelection()},getBuffer:function(){return this.opts.buffer===!1?!1:(e.browser.msie||this.restoreSelection(),this.opts.buffer=!1,void 0)},execCommand:function(n,i){try{if(("undo"==n||"redo"==n)&&this.undoDisable)return;var r;if("inserthtml"===n&&e.browser.msie)"inserthtml"===n&&e.browser.msie&&(window.getSelection?this.pasteHtmlAtCaret(i):document.selection.createRange().pasteHTML(i));else if("formatblock"===n&&e.browser.msie)document.execCommand(n,!1,"<"+i+">");else if("unlink"===n)r=this.getParentNode(),"A"===e(r).get(0).tagName?e(r).replaceWith(t(e(r).text())):document.execCommand(n,!1,i);else if("formatblock"===n&&"blockquote"===i)if(r=this.getParentNode(),"BLOCKQUOTE"===e(r).get(0).tagName)document.execCommand(n,!1,"p");else if("P"===e(r).get(0).tagName){var o=e(r).parent();if("BLOCKQUOTE"===e(o).get(0).tagName){var s=e("<p>"+e(r).html()+"</p>");e(o).replaceWith(s),this.setFocusNode(s.get(0))}else document.execCommand(n,!1,i)}else document.execCommand(n,!1,i);else if("formatblock"===n&&"pre"===i)r=this.getParentNode(),"PRE"===e(r).get(0).tagName?e(r).replaceWith("<p>"+e(r).text()+"</p>"):document.execCommand(n,!1,i);else if("forecolor"==n||"BackColor"==n||"fontName"==n||"hilitecolor"==n||"backcolor"==n||"fontSize"==n){1==e.browser.msie;try{document.execCommand("styleWithCSS",!1,!0),document.execCommand(n,!1,i),document.execCommand("styleWithCSS",!1,!1)}catch(a){document.execCommand(n,!1,i)}}else"undo"!=n&&"redo"!=n||1!=e.browser.msie?(document.execCommand(n,!1,i),"undo"!=n&&"redo"!=n||!this.hasQuotedText||this.$quoted.checkQuotedText(),"redo"==n&&e('pre[rel="highlighter"]').length>0&&e('pre[rel="highlighter"]').attr("contenteditable",!1)):document.execCommand(n);"inserthorizontalrule"===n&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),"function"==typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,n),this.opts.air&&this.air.hide()}catch(a){console.log("Error ",a)}},pasteHtmlAtCaret:function(e){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0),range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var n,i,r=document.createDocumentFragment();n=t.firstChild;)i=r.appendChild(n);range.insertNode(r),i&&(range=range.cloneRange(),range.setStartAfter(i),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}},formatNewLine:function(t){if(!e.browser.webkit)return this.syncCode(),!0;var n=this.getParentNode();if("DIV"!==n.nodeName||"redactor_editor"!==n.className)return this.syncCode(),!0;t.preventDefault();var i=e(this.getCurrentNode());if("DIV"===i.get(0).tagName&&(""===i.html()||"<br>"===i.html())){var r=e("<p>").append(i.clone().get(0).childNodes);return i.replaceWith(r),r.html("<br />"),this.setFocusNode(r.get(0)),this.syncCode(),!1}this.syncCode(),this.opts.convertLinks&&this.$editor.linkify()},safariShiftKeyEnter:function(t,n){if(t.shiftKey&&13===n){t.preventDefault();var i=e("<span><br /></span>");return this.insertNodeAtCaret(i.get(0)),this.syncCode(),!1}return!0},formatEmpty:function(t){var n=e.trim(this.$editor.html());if(e.browser.mozilla&&(n=n.replace(/<br>/i,"")),""===n){t.preventDefault();var i=this.opts.allEmptyHtml;e.browser.mozilla&&(i=this.opts.mozillaEmptyHtml);var r=e(i).get(0);return this.$editor.html(r),this.setFocusNode(r),this.syncCode(),!1}this.syncCode()},paragraphy:function(t){if(t=e.trim(t),""===t)return e.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var n=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},i=function(e,i){return n(t,e,i)},r="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return t+="\n",i("<br />\\s*<br />","\n\n"),i("(<"+r+"[^>]*>)","\n$1"),i("(</"+r+">)","$1\n\n"),i("\r\n|\r","\n"),i("\n\n+","\n\n"),i("\n?((.|\n)+?)$","<p>$1</p>\n"),i("<p>\\s*?</p>",""),i("<p>(<div[^>]*>\\s*)","$1<p>"),i("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),i("<p>\\s*(</?"+r+"[^>]*>)\\s*</p>","$1"),i("<p>(<li.+?)</p>","$1"),i("<p>\\s*(</?"+r+"[^>]*>)","$1"),i("(</?"+r+"[^>]*>)\\s*</p>","$1"),i("(</?"+r+"[^>]*>)\\s*<br />","$1"),i("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),-1!=t.indexOf("<pre")&&i("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(e,t,i,r){return n(t,"\\\\(['\"\\\\])","$1")+n(n(n(r,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),i("\n</p>$","</p>")},stripTags:function(t){var n=this.opts.allowedTags;1==e.browser.webkit&&-1==navigator.appVersion.indexOf("Win")&&(n[n.length]="style");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t.replace(i,function(t,i){return e.inArray(i.toLowerCase(),n)>"-1"?t:""})},pasteCleanUp:function(t){if(0==this.textPaste){t=t.replace(/(&nbsp;){2,}/gi,"&nbsp;"),t=t.replace(/&nbsp;/gi," "),this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var n=this;e.browser.chrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),e.browser.chrome&&-1!=navigator.appVersion.indexOf("Win")&&(t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),t=t.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,"")),t=t.replace(/<!--[\s\S]*?-->/g,""),t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=t.replace(/\[td\]/gi,"<td>&nbsp;</td>"),t=t.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),t=t.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),t=t.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),t=t.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),t=t.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),t=t.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),t=t.replace(/\[param(.*?)\]/gi,"<param$1>"),t=t.replace(/\[img(.*?)\]/gi,"<img$1>"),t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"),t=t.replace(/<\/div><p>/gi,"<p>"),t=t.replace(/<\/p><\/div>/gi,"</p>"),t=t.replace(/<p><p>/g,"<p>"),t=t.replace(/<\/p><\/p>/g,"</p>"),t=this.stripTags(t),t=this.cleanParagraphy(t),t=t.replace(/\n{3,}/gi,"\n"),e.browser.msie&&document.documentMode>=9&&(t=t.replace(/\n/g," "),t=t.replace(/>\s+</g,"><"));var i=e("<div></div>"),r="strong",o="em";t=t.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+o+">$1</"+o+">"),t=t.replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+r+">$1</"+r+">"),t=t.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),t=t.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),t=t.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>"),i.html(t),i.find("*").each(function(){var t=e(this).attr("align");if(e(this).removeAttr("align"),t&&e(this).css("text-align",t),style=e(this).attr("style"),e(this).removeAttr("style"),style)for(var i=style.split(/[;]/),r=0;r<i.length;r++){var o=i[r].split(":");o[0]=e.trim(o[0]),o[1]=e.trim(o[1]),"mso-highlight"==o[0]?e(this).css("background-color",o[1]):"font-family"==o[0]?n.opts.setFontSettings?e(this).css("font-family",n.opts.wrapFontSettings["font-family"]):e(this).css("font-family",o[1]):"color"==o[0]?e(this).css("color",o[1]):"font-size"==o[0]?e(this).css("font-size",o[1].replace("pt","px")):"font-weight"==o[0]?e(this).css("font-weight",o[1]):"background"==o[0]?1==e.browser.msie||1==e.browser.mozilla?e(this).css("background-color",o[1]):e(this).css("background",o[1]):"background-color"==o[0]?e(this).css("background-color",o[1]):"text-align"==o[0]?1==e.browser.mozilla?(e(this).attr("align",o[1]),e(this).css("text-align","")):e(this).css("text-align",o[1]):"margin"==o[0]?e(this).css("margin",o[1]):"border"==o[0]?e(this).css("border",o[1]):"padding"==o[0]?e(this).css("padding",o[1]):"margin-left"==o[0]?e(this).css("margin-left",o[1]):"text-indent"==o[0]&&e(this).css("text-indent",o[1])}}),i.find("*").removeAttr("class"),i.find("p span:only-child").each(function(){jQuery.trim(jQuery(this).text()).length||jQuery(this).html("&nbsp;")}),t=i.html(),t=t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),this.execCommand("inserthtml",t)}else this.textPaste=!1,this.execCommand("inserttext",t);this.opts.autoresize===!0?e(document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},cleanParagraphy:function(t){function n(e,n,i){return t.replace(new RegExp(e,n),i)}if(t=e.trim(t),""===t||"<p></p>"===t)return t;t+="\n";var i=[],r=0;if(-1!==t.search(/<(table|div|pre|object)/gi)){var o=t.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi);null!=o&&e.each(o,function(e,n){e++,i[e]=n,t=t.replace(n,"{replace"+e+"}\n")})}t=t.replace(/<\!\-\-([\w\W]*?)\-\->/gi,"<comment>$1</comment>"),t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n");var s="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";t=n("(<"+s+"[^>]*>)","gi","\n$1"),t=n("(</"+s+">)","gi","$1\n\n"),t=n("\r\n","g","\n"),t=n("\r","g","\n"),t=n("/\n\n+/","g","\n\n");var a=t.split(new RegExp("\ns*\n","g"),-1);t="";for(var r in a)a.hasOwnProperty(r)&&(t+=-1==a[r].search("{replace")?1==e.browser.mozilla||1==e.browser.msie?a[r].replace(/^\n+|\n+$/g,""):"<p>"+a[r].replace(/^\n+|\n+$/g,"")+"</p>":a[r]);if(-1!==t.search(/<blockquote/gi)){var l=t.match(/<blockquote(.*?)>([\w\W]*?)<\/blockquote>/gi);null!=l&&e.each(l,function(e,n){var i="";i=n.replace("<p>",""),i=i.replace("</p>","<br>"),t=t.replace(n,i)})}return t=n("<p>s*</p>","gi",""),t=n("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),t=n("<p>s*(</?"+s+"[^>]*>)s*</p>","gi","$1"),t=n("<p>(<li.+?)</p>","gi","$1"),t=n("<p>s*(</?"+s+"[^>]*>)","gi","$1"),t=n("(</?"+s+"[^>]*>)s*</p>","gi","$1"),t=n("(</?"+s+"[^>]*>)s*<br />","gi","$1"),t=n("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),t=n("\n</p>","gi","</p>"),t=n("</li><p>","gi","</li>"),t=n("</ol><p>","gi","</ol>"),t=n("<p>	?\n?<p>","gi","<p>"),t=n("</dt><p>","gi","</dt>"),t=n("</dd><p>","gi","</dd>"),t=n("<br></p></blockquote>","gi","</blockquote>"),e.each(i,function(e,n){t=t.replace("{replace"+e+"}",n)}),t=t.replace(/<comment>([\w\W]*?)<\/comment>/gi,"<!--$1-->"),e.trim(t)},formattingRemove:function(t){var n=[],i=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==i&&e.each(i,function(e,i){t=t.replace(i,"prebuffer_"+e),n.push(i)}),t=t.replace(/\s{2,}/g," "),t=t.replace(/\n/g," "),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g,""),t=t.replace(/[\s\n]*$/g,""),t=t.replace(/>\s+</g,"><"),n&&(e.each(n,function(e,n){t=t.replace("prebuffer_"+e,n)}),n=[]),t},formattingIndenting:function(e){return e=e.replace(/<li/g,"	<li"),e=e.replace(/<tr/g,"	<tr"),e=e.replace(/<td/g,"		<td"),e=e.replace(/<\/tr>/g,"	</tr>")},formattingEmptyTags:function(e){for(var t=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<div>\\s*</div>"],n=0;n<t.length;++n){var i=t[n];e=e.replace(new RegExp(i,"gi"),"")}return e},formattingAddBefore:function(e){for(var t="\r\n",n=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],i=0;i<n.length;++i){var r=n[i];e=e.replace(new RegExp(r,"gi"),t+r)}return e},formattingAddAfter:function(e){for(var t="\r\n",n=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],i=0;i<n.length;++i){var r=n[i];e=e.replace(new RegExp(r,"gi"),r+t)}return e},formatting:function(e){return e=this.formattingRemove(e),e=this.formattingEmptyTags(e),e=this.formattingAddBefore(e),e=this.formattingAddAfter(e),e=this.formattingIndenting(e)},selectionToggle:function(){this.$editor.html(this.$el.val())},toggle:function(){var t;this.opts.visual?(this.deleteCursor(),this.$editor.hide(),t=this.$editor.html(),t=e.trim(this.formatting(t)),this.$el.height(this.$editor.innerHeight()).val(t).show().focus(),this.$toolbar.find("li").each(function(){(void 0==e(this).attr("class")||"redactor_separator"==e(this).attr("class"))&&e(this).hide()}),this.setBtnActive("html"),this.opts.visual=!1):(this.$el.hide(),this.$editor.show(),""===this.$editor.html()&&(t=e.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml,this.$el.val(t)),this.selectionToggle(),this.$toolbar.find("li").each(function(){(void 0==e(this).attr("class")||"redactor_separator"==e(this).attr("class"))&&e(this).show()}),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables(),this.observeCode())},autoSave:function(){setInterval(e.proxy(function(){e.post(this.opts.autosave,{data:this.getCode()})},this),1e3*this.opts.interval)},buildToolbar:function(){return this.opts.toolbar===!1?!1:(this.$toolbar=e("<ul>").addClass("redactor_toolbar"),this.opts.air?(e(this.air).append(this.$toolbar),e("body").prepend(this.air)):this.opts.toolbarExternal===!1?this.$box.prepend(this.$toolbar):e(this.opts.toolbarExternal).html(this.$toolbar),e.each(this.opts.buttons,e.proxy(function(t,n){if("|"!==n&&"undefined"!=typeof this.opts.toolbar[n]){var i=this.opts.toolbar[n];if(this.opts.fileUpload===!1&&"file"===n)return!0;var r=e("<li>"),o=this.buildButton(n,i);if("backcolor"===n||"fontcolor"===n||"undefined"!=typeof i.dropdown||"fontname"===n||"fontsize"===n){var s=e('<div class="redactor_dropdown" style="display: none;">');s="backcolor"===n||"fontcolor"===n?this.buildColorPicker(s,n):"fontname"===n?this.buildFontNamePicker(s,n):"fontsize"===n?this.buildFontSizePicker(s,n):this.buildDropdown(s,i.dropdown),this.dropdowns.push(s.appendTo(e(document.body))),this.hdlHideDropDown=e.proxy(function(e){this.hideDropDown(e,s,n)},this),this.hdlShowDropDown=e.proxy(function(t){e.browser.opera||this.$editor.focus(),this.showDropDown(t,s,n)},this),o.click(this.hdlShowDropDown)}"html"==n&&e(r).attr("class","button_right"),this.$toolbar.append(e(r).append(o)),"html"==n&&this.$toolbar.append(e('<li class="redactor_separator button_right"></li>'))}"|"===n&&this.$toolbar.append(e('<li class="redactor_separator"></li>'))},this)),e(document).click(this.hdlHideDropDown),this.$editor.click(this.hdlHideDropDown),void 0)},buildButton:function(t,n){var i=e('<a href="javascript:void(null);" title="'+n.title+'" class="redactor_btn_'+t+'" tabindex="-1"></a>');return"undefined"==typeof n.func?i.click(e.proxy(function(){this.insertOnCursorPosition(n.exec,t)},this)):"show"!==n.func&&i.click(e.proxy(function(e){"redactor_btn_removeFormat"!=e.currentTarget.className&&"redactor_btn_fontsize"!=e.currentTarget.className&&"redactor_btn_fontname"!=e.currentTarget.className?this.focusOnCursor():this.$editor.focus(),this[n.func](e)},this)),"undefined"!=typeof n.callback&&i.click(e.proxy(function(e){this.focusOnCursor(),n.callback(this,e,t)},this)),i},buildDropdown:function(t,n){return e.each(n,e.proxy(function(n,i){"undefined"==typeof i.className&&(i.className=""),"undefined"==typeof i.titleText&&(i.titleText="");var r;"undefined"!=typeof i.name&&"separator"===i.name?r=e('<a class="redactor_separator_drop '+i.className+' ">'):(r=e('<a href="javascript:void(null);" class="'+i.className+'" title = "'+i.titleText+'">'+i.title+"</a>"),"undefined"==typeof i.func?e(r).click(e.proxy(function(){this.execCommand(i.exec,n)},this)):e(r).click(e.proxy(function(e){this[i.func](e)},this))),e(t).append(r)},this)),t},buildColorPicker:function(t,n){var i;i="backcolor"===n?e.browser.msie?"BackColor":"hilitecolor":"forecolor",e(t).width(210);for(var r=this.opts.colors.length,o=0;r>o;++o){var s=this.opts.colors[o],a=e('<a rel="'+s+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:s});e(t).append(a);var l=this;e(a).click(function(){l.execCommand(i,e(this).attr("rel"))})}return t},buildFontNamePicker:function(t){e(t).width(210),e(t).height(175);for(var n=this.opts.fontnames.length,i=0;n>i;++i){var r=this.opts.fontnames[i],o=e('<a rel="'+r+'" href="javascript:void(null);" class="redactor_font_link">'+r+"</a>").css({"font-family":r});("Symbol"===r||"Webdings"===r)&&o.css({"font-family":"Helvetica Neue"}),e(t).append(o);var s=this;e(o).click(function(){s.execCommand("fontName",e(this).attr("rel"))})}return t},buildFontSizePicker:function(t){e(t).width(210),e(t).height(190);for(var n=this.opts.fontsizes.length,i=0;n>i;++i){var r=this.opts.fontsize_levels[this.opts.fontsizes[i]],o=this.opts.fontsizes[i],s=this.opts.fontsize_naming[i],a=e('<a rel="'+o+'" href="javascript:void(null);" class="redactor_font_link '+s+'" >'+s+" </a>").css({"font-size":r,"line-height":r+8+"px"});e(t).append(a);var l=this;e(a).click(function(){l.execCommand("fontSize",Number(e(this).attr("rel")))})}return t},buildremoveFormat:function(){var t;if(""==this.getSelectedHtml())confirm(RLANG.confirm_remove_format_for_entire_content)&&(t=this.removeFormatGetSelection(),t=e.browser.msie?t.replace(/\n+/g,"</p><p>"):t.replace(/\n+/g,"<br /></p><p>"),this.execCommand("selectAll",null),this.execCommand("inserthtml","<p>"+t));else{t=this.removeFormatGetSelection(),t=t.replace(/^\n+|\n+$/,"");var n=e("<span />");n.css({"font-family":this.$editor.css("font-family"),"font-size":this.$editor.css("font-size"),color:this.$editor.css("color"),"background-color":this.$editor.css("background-color")}),n.attr("rel","tempredactor");var i=t;t="";var r=0;e.each(i.split("\n"),function(){if(""!=e.trim(this.toString())){1==r?t+=e.browser.msie?"</p><p>":"<br /></p><p>":r=1,n.html(this.toString());var i=e("<span />").html(n);t+=i.html()}}),t=t.replace(/\n+/g,"<br/>"),(e.browser.mozilla||e.browser.msie)&&(t=t.split("").reverse().join("").replace(/\>p\</,"").split("").reverse().join("")),this.insertHtml(t)}this.syncCode()},removeFormatGetSelection:function(){if(this.execCommand("removeFormat",""),""==this.getSelectedHtml())var t=e("<span>"+this.getCode()+"</span>");else var t=e("<span>"+this.getSelectedHtml()+"</span>");return t.html(this.formatting(t.html())),replacehtml=t.text().replace(/\n+/g,"\n").replace(/</g,"&lt;").replace(/>/g,"&gt;")},showDropDown:function(t,n,i){if(this.getBtn(i).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(i),this.getBtn(i).addClass("dropact");var r=this.getBtn(i).offset().left;if(this.opts.air){var o=this.air.offset().top;e(n).css({position:"absolute",left:r+"px",top:o+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)e(n).css({position:"fixed",left:r+"px",top:"30px"}).show();else{var s=this.$toolbar.offset().top+30;e(n).css({position:"absolute",left:r+"px",top:s+"px"}).show()}}},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact"),e(".redactor_dropdown").hide()},hideDropDown:function(t,n){e(t.target).hasClass("dropact")||(e(n).removeClass("act"),this.showedDropDown=!1,this.hideAllDropDown())},getSelection:function(){return"undefined"!=typeof window.getSelection?document.getSelection():"undefined"!=typeof document.selection?document.selection.createRange():void 0},getFragmentHtml:function(e){var t=e.cloneNode(!0),n=document.createElement("div");return n.appendChild(t),n.innerHTML},extractContent:function(){for(var e,t=this.$editor.get(0),n=document.createDocumentFragment();e=t.firstChild;)n.appendChild(e);return n},saveSelection:function(){if(this.savedSel=null,this.savedSelObj=null,e.browser.msie&&parseInt(e.browser.version,10)<9){var t=this.$editor.get(0);this.savedSel=window.Selection.getOrigin(t),this.savedSelObj=window.Selection.getFocus(t)}else{e.browser.msie&&parseInt(e.browser.version,10)>10&&(this.undoDisable=!0);var n=this.getSelection();this.savedSel=[],this.savedSelObj=[],this.savedSel[0]=n.anchorNode,this.savedSel[1]=n.anchorOffset,this.savedSelObj[0]=n.focusNode,this.savedSelObj[1]=n.focusOffset}},restoreSelection:function(){null!==this.savedSel&&null!==this.savedSelObj&&"BODY"!==this.savedSel[0].tagName?window.Selection.setSelection(window,this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]):this.$editor.focus()},getParentNode:function(){try{if("undefined"!=typeof window.getSelection){var e=window.getSelection();return e.rangeCount>0?this.getSelection().getRangeAt(0).startContainer.parentNode:!1}if("undefined"!=typeof document.selection)return this.getSelection().parentElement()}catch(t){}},getCurrentNode:function(){try{if("undefined"!=typeof window.getSelection)return this.getSelection().getRangeAt(0).startContainer;if("undefined"!=typeof document.selection)return this.getSelection()}catch(e){}},setFocusNode:function(e){if("undefined"==typeof e)return!1;try{var t=document.createRange(),n=this.getSelection();null!==n&&(t.selectNodeContents(e),n.addRange(t),n.collapse(e,0)),this.$editor.focus()}catch(i){}},insertNodeAtCaret:function(e){if(window.getSelection){var t=this.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);n.collapse(!1),n.insertNode(e),n=n.cloneRange(),n.selectNodeContents(e),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}}else if(document.selection){var i=1===e.nodeType?e.outerHTML:e.data,r="marker_"+(""+Math.random()).slice(2);i+='<span id="'+r+'"></span>';var o=this.getSelection();o.collapse(!1),o.pasteHTML(i);var s=document.getElementById(r);o.moveToElementText(s),o.select(),s.parentNode.removeChild(s)}},getSelectedHtml:function(){var e="";if(window.getSelection){var t=window.getSelection();if(t.rangeCount){for(var n=document.createElement("div"),i=0,r=t.rangeCount;r>i;++i)n.appendChild(t.getRangeAt(i).cloneContents());e=n.innerHTML}}else document.selection&&"Text"===document.selection.type&&(e=document.selection.createRange().htmlText);return e},cleanStyleAttr:function(){this.$editor.on("DOMNodeInserted",e.proxy(function(t){if(e(t.target).attr("style"))for(var n=e(t.target).attr("style").split(";"),i=0;i<n.length;i++)if(n[i]){var r=n[i].split(":");this.compareParentStyles(e(t.target),r[0])}e(t.target).attr("style")&&0==e(t.target).attr("style").length&&e(t.target).removeAttr("style")},this))},getBtn:function(t){return e(this.$toolbar.find("a.redactor_btn_"+t))},setBtnActive:function(e){this.getBtn(e).addClass("act")},setBtnInactive:function(e){this.getBtn(e).removeClass("act")},inactiveAllButtons:function(){e.each(this.opts.activeButtons,e.proxy(function(e,t){this.setBtnInactive(t)},this))},resizeImage:function(t){var n,i,r=!1,o=!1,s=e(t).width()/e(t).height(),a=10,l=10;e(t).off(".redactor"),e(t).on({"mouseleave.redactor":function(){r=!1},"mousedown.redactor":function(s){s.preventDefault(),r=!0,o=!0,n=Math.round(s.pageX-e(t).eq(0).offset().left),i=Math.round(s.pageY-e(t).eq(0).offset().top)},"mouseup.redactor":e.proxy(function(){r=!1,this.syncCode()},this),"click.redactor":e.proxy(function(e){o&&this.imageEdit(e)},this),"mousemove.redactor":function(c){if(r){o=!1,Math.round(c.pageX-e(this).eq(0).offset().left)-n;var u=Math.round(c.pageY-e(this).eq(0).offset().top)-i,d=e(t).height(),h=parseInt(d,10)+u,f=h*s;f>a&&e(t).width(f),h>l&&(e(t).height(h),e(t).attr("data-height",h)),n=Math.round(c.pageX-e(this).eq(0).offset().left),i=Math.round(c.pageY-e(this).eq(0).offset().top)}}})},toggleTableOptions:function(){e(".table_optional").toggle(0!=e(this.getCurrentNode()).parents("table").length)},showTable:function(){this.saveSelection(),this.modalInit(RLANG.table,"table",300,e.proxy(function(){e("#redactor_insert_table_btn").click(e.proxy(this.insertTable,this))},this),function(){e("#redactor_table_rows").focus()})},insertTable:function(){for(var t=e("#redactor_table_rows").val(),n=e("#redactor_table_columns").val(),i=e("<div></div>"),r=Math.floor(99999*Math.random()),o=e('<table id="table'+r+'" border="1" cellspacing="0" cellpadding="0"><tbody></tbody></table>'),s=0;t>s;s++){for(var a=e("<tr></tr>"),l=0;n>l;l++){var c=e("<td><br></td>");e(a).append(c)}e(o).append(a)}e(i).append(o);var u=e(i).html()+"<p></p>";this.restoreSelection(),this.execCommand("inserthtml",u),this.modalClose(),this.observeTables()},tableObserver:function(t){this.$table=e(t.target).parents("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$table_td.removeClass("current"),this.$tbody=e(t.target).parents("tbody"),this.$thead=e(this.$table).find("thead"),this.$current_td=e(t.target),this.$current_td.addClass("current"),this.$current_tr=e(t.target).parents("tr")},deleteTable:function(){e(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){e(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var t=e(this.$current_td).get(0).cellIndex;e(this.$table).find("tr").each(function(){e(this).find("td").eq(t).remove()}),this.syncCode()},addHead:function(){if(0!==e(this.$table).find("thead").size())this.deleteHead();else{var t=e(this.$table).find("tr").first().clone();t.find("td").html("&nbsp;"),this.$thead=e("<thead></thead>"),this.$thead.append(t),e(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){e(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(t){var n=e(this.$current_tr).clone();n.find("td").html("&nbsp;"),"after"===t?e(this.$current_tr).after(n):e(this.$current_tr).before(n),this.syncCode()},insertColumn:function(t){var n=0;this.$current_td.addClass("current"),this.$current_tr.find("td").each(function(t,i){e(i).hasClass("current")&&(n=t)}),this.$table_tr.each(function(i,r){var o=e(r).find("td").eq(n),s=o.clone();s.html("&nbsp;"),"after"===t?e(o).after(s):e(o).before(s)}),this.syncCode()},showCodeEditor:function(t){this.saveSelection(),this.selectedEvent=t,this.modalInit(RLANG.codeEditor,"codeEditor",650,e.proxy(function(){e("#redactor_insert_code_btn").click(e.proxy(this.insertCode,this)),"PRE"==e(t.target)[0].tagName?(e("#redactorInsertCode_selector").find("option").each(function(){e(this).val()==e(t.target).attr("code-brush")&&e(this).prop("selected","selected")}),e("#redactor_code_delete_btn").removeClass("hide"),e("#redactor_code_delete_btn").click(e.proxy(function(){this.deleteElement(e(t.target))},this))):e("#redactor_code_delete_btn").addClass("hide"),setTimeout(function(){void 0!=jQuery.fn.tabby?e("#redactor_insert_text_area").focus().tabby():e("#redactor_insert_text_area").focus()},200)},this))},insertCode:function(){this.restoreSelection();var t=e("#redactor_insert_text_area").val(),n=t.split(/\r|\r\n|\n/),i="";if(n.length>10&&(i="code-large"),e.browser.msie&&(parseInt(e.browser.version,10)<9||parseInt(e.browser.version,10)>10)){var r=e(this.selectedEvent.target);r.is("pre")?(r.attr("code-brush",e("#redactorInsertCode_selector").val()).text(t),r.toggleClass("code-large",""!=i&&null!=i)):this.appendCodeTag(t,i)}else{var o=e(this.getSelection().anchorNode).parent();if(o.is("pre")){var s=document.createRange();s.selectNode(o[0]),this.getSelection().removeAllRanges(),this.getSelection().addRange(s),this.appendCodeTag(t,i)}else this.appendCodeTag(t,i)}this.observeCode(),this.modalClose()},observeCode:function(){this.getBtn("codeEditor").get(0)&&(this.$editor.find("pre").each(e.proxy(function(t,n){e(n).attr("contenteditable",!1),e(n).off("click"),e(n).on("click",e.proxy(function(t){this.showCodeEditor(t),e.browser.msie&&parseInt(e.browser.version,10)<9?e("#redactor_insert_text_area").val(e(n).html().replace(/&lt;/g,"<").replace(/&gt;/g,">")):e("#redactor_insert_text_area").val(e(n).text())},this))},this)),this.syncCode())
},buildLangSelector:function(){var t='<select id="redactorInsertCode_selector" name="highlight-brush-type" data-minimum-results-for-search="100" class="select2 input-medium">';e.each(codeEditor_lang,function(e,n){t+='<option value="'+e+'">'+n+"</option>"}),t+="</select>",RLANG.lang_selector=t},appendCodeTag:function(t,n){var i=e("<div />");i.append(e("<p />").html("&nbsp;")),i.append(e("<pre />").attr("rel","highlighter").attr("code-brush",e("#redactorInsertCode_selector").val()).addClass(n).text(t)),i.append(e("<p />").html("&nbsp;")),this.execCommand("inserthtml",i.html())},showVideo:function(){this.saveSelection(),this.modalInit(RLANG.video,"video",600,e.proxy(function(){e("#redactor_insert_video_btn").click(e.proxy(this.insertVideo,this)),e("#redactor_insert_video_area").focus()},this))},insertVideo:function(){var t=e("#redactor_insert_video_area").val();t=this.stripTags(t),this.restoreSelection(),this.execCommand("inserthtml",t),this.modalClose()},setDefaultSelection:function(){if(!this.getSelection().getRangeAt(0).commonAncestorContainer.isEqualNode(this.$editor.get(0))){var e=this.getSelection();e.removeAllRanges();var t=document.createRange();t.setStart(this.$editor.get(0),0),t.setEnd(this.$editor.get(0),0),e.addRange(t)}},insertExternal:function(t){this.$editor.focus(),this.setDefaultSelection();var n=e(this.stripTags(t)).get(0);this.execCommand("inserthtml",this.stripTags(t));var i=this.getSelection(),r=document.createRange();i.removeAllRanges(),this.$editor.find("iframe").each(function(){e(this).attr("src")==e(n).attr("src")&&(r.selectNode(e(this).get(0)),r.collapse(!1),i.addRange(r))}),this.syncCode()},imageEdit:function(t){var n=e(t.target),i=n.parent(),r=e.proxy(function(){e("#redactor_file_alt").val(n.attr("alt")),e("#redactor_image_edit_src").attr("href",n.attr("src")),e("#redactor_form_image_align").val(n.css("float")),"A"===e(i).get(0).tagName&&e("#redactor_file_link").val(e(i).attr("href")),e("#redactor_image_delete_btn").click(e.proxy(function(){this.deleteElement(n)},this)),e("#redactorSaveBtn").click(e.proxy(function(){this.imageSave(n)},this))},this);this.modalInit(RLANG.image,"image_edit",380,r)},deleteElement:function(t){e(t).remove(),this.modalClose(),this.syncCode()},imageSave:function(t){var n=e(t).parent();e(t).attr("alt",e("#redactor_file_alt").val());var i=e("#redactor_form_image_align").val();"left"===i?e(t).css({"float":"left",margin:"0 10px 10px 0"}):"right"===i?e(t).css({"float":"right",margin:"0 0 10px 10px"}):e(t).css({"float":"none",margin:"0"});var r=e.trim(e("#redactor_file_link").val());if(""!==r)if("A"!==e(n).get(0).tagName){var o=e("<a >").attr("href",r).html(this.outerHTML(t)).get(0).outerHTML;e(t).replaceWith(o)}else e(n).attr("href",r);else"A"===e(n).get(0).tagName&&e(n).replaceWith(this.outerHTML(t));this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var t=e.proxy(function(){if(this.opts.imageGetJson!==!1?e.getJSON(this.opts.imageGetJson,e.proxy(function(t){var n={},i=0;e.each(t,e.proxy(function(e,t){"undefined"!=typeof t.folder&&(i++,n[t.folder]=i)},this));var r=!1;if(e.each(t,e.proxy(function(t,i){var o="";"undefined"!=typeof i.title&&(o=i.title);var s=0;e.isEmptyObject(n)||"undefined"==typeof i.folder||(s=n[i.folder],r===!1&&(r=".redactorfolder"+s));var a=e("<a />").addClass("redactor_image_element").css({backgroundImage:"url('"+i.thumb+"')"});a.attr({rel:i.image,title:o,href:"javascript:void(null);"}),e("#redactor_image_box").append(a),e(a).click(e.proxy(this.imageSetThumb,this))},this)),!e.isEmptyObject(n)){e(".redactorfolder").hide(),e(r).show();var o=function(t){e(".redactorfolder").hide(),e(".redactorfolder"+e(t.target).val()).show()},s=e('<select id="redactor_image_box_select">');e.each(n,function(t,n){s.append(e('<option value="'+n+'">'+t+"</option>"))}),e("#redactor_image_box").before(s),s.change(o)}},this)):e("#redactor_tabs a").eq(1).remove(),this.opts.imageUpload!==!1)e("#redactor_image_choose_help_text").hide(),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&0!==e("#redactor_file").size()&&e("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:{_uniquekey:e.proxy(function(){return this.uniqueKey},this)},success:e.proxy(this.imageUploadCallback,this),error:e.proxy(this.imageUploadCallback,this),ondropCallback:e.proxy(this.insertLoadingAtCaret,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:e.proxy(this.imageUploadCallback,this)});else if(e(".redactor_tab").hide(),this.opts.imageGetJson===!1)e("#redactor_image_choose_help_text").hide(),e("#redactor_tabs").remove(),e("#redactor_tab3").show();else{var t=e("#redactor_tabs a");t.eq(0).remove(),t.eq(1).addClass("redactor_tabs_act"),e("#redactor_tab2").show()}e("#redactor_upload_btn").click(e.proxy(this.imageUploadCallbackLink,this))},this),n=e.proxy(function(){this.opts.imageUpload===!1&&this.opts.imageGetJson===!1?e("#redactor_file_link").focus():e("#redactor_upload_btn").hide()},this);this.modalInit(RLANG.image,"image",570,t,n,!0)},imageSetThumb:function(t){this._imageSet('<img src="'+e(t.target).attr("rel")+'" alt="'+e(t.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==e("#redactor_file_link").val()){var t=e("<img >").attr("src",e("#redactor_file_link").val()).get(0).outerHTML;this._imageSet(t,!0)}else this.modalClose()},imageUploadCallback:function(e){this._imageSet(e)},_imageSet:function(t,n){var i=!0;if(t!==!1){var r="",o="";if(n!==!0)if(t.isJSON()&&(o=e.parseJSON(t)),void 0!=o.filelink)r='<p><img src="'+o.filelink+'" class= "inline-image" data-id = "'+o.fileid+'" /></p>',this.$editor.find("#uploading_images_"+o.uniquekey).replaceWith(e(r)),this.syncCode(),0==this.$editor.find("img.image-loader").length&&("function"==typeof this.opts.imageLoadedCallback?this.opts.imageLoadedCallback(this):this.enableFormAfterLoadingImage());else{try{alert(JSON.parse(t).error||RLANG.invalid_image_file)}catch(s){alert(RLANG.invalid_image_file)}this.$editor.find("img.image-loader").remove(),"function"==typeof this.opts.imageLoadedCallback?this.opts.imageLoadedCallback(this):this.enableFormAfterLoadingImage(),i=!1}else r=t,this.modalClose(),this.restoreSelection(),this.execCommand("inserthtml",r);n!==!0&&"function"==typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,o)}i&&this.observeImages()},showLink:function(){this.saveSelection();var t=e.proxy(function(){this.insert_link_node=!1;var t=this.getSelection(),n="",i="",r="";if(e.browser.msie){var o=this.getParentNode();"A"===o.nodeName?(this.insert_link_node=e(o),i=this.insert_link_node.text(),n=this.insert_link_node.attr("href"),r=this.insert_link_node.attr("target")):i=this.oldIE()?t.text:t.toString()}else t&&t.anchorNode&&"A"===t.anchorNode.parentNode.tagName?(n=e(t.anchorNode.parentNode).attr("href"),i=t.anchorNode.parentNode.text,r=t.anchorNode.parentNode.target,""===t.toString()&&(this.insert_link_node=t.anchorNode.parentNode)):i=t.toString();e(".redactor_link_text").val(i);var s=n.replace(self.location.href,"");0===n.search("mailto:")?(this.setModalTab(2),e("#redactor_tab_selected").val(2),e("#redactor_link_mailto").val(n.replace("mailto:",""))):0===s.search(/^#/gi)?(this.setModalTab(3),e("#redactor_tab_selected").val(3),e("#redactor_link_anchor").val(s.replace(/^#/gi,""))):e("#redactor_link_url").val(n),"_blank"===r&&e("#redactor_link_blank").attr("checked",!0),e("#redactor_insert_link_btn").click(e.proxy(this.insertLink,this))},this),n=function(){e("#redactor_link_url").focus()};this.modalInit(RLANG.link,"link",460,t,n)},insertLink:function(){var n=e("#redactor_tab_selected").val(),i="",r="",o="";"1"===n?(i=e("#redactor_link_url").val(),r=t(e("#redactor_link_url_text").val()),e("#redactor_link_blank").attr("checked")&&(o="_blank")):"2"===n?(i="mailto:"+e("#redactor_link_mailto").val(),r=t(e("#redactor_link_mailto_text").val())):"3"===n&&(i="#"+e("#redactor_link_anchor").val(),r=t(e("#redactor_link_anchor_text").val())),this._insertLink('<a href="'+i.replace(/"/g,"&quot;")+'" target="'+o+'">'+r+"</a>",e.trim(r),i,o)},_insertLink:function(t,n,i,r){this.restoreSelection(),""!==n&&(this.insert_link_node?(e(this.insert_link_node).text(n),e(this.insert_link_node).attr("href",i),""!==r&&e(this.insert_link_node).attr("target",r),this.syncCode()):this.insertOnCursorPosition("inserthtml",t)),this.modalClose()},showFile:function(){this.saveSelection();var t=e.proxy(function(){var t=this.getSelection(),n="";n=this.oldIE()?t.text:t.toString(),e("#redactor_filename").val(n),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&e("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:e.proxy(function(e){this.fileUploadCallback(e)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:e.proxy(function(e){this.fileUploadCallback(e)},this)})},this);this.modalInit(RLANG.file,"file",500,t)},fileUploadCallback:function(t){if(this.restoreSelection(),t!==!1){var n=e.parseJSON(t),i=e("#redactor_filename").val();""===i&&(i=n.filename);var r='<a href="'+n.filelink+'">'+i+"</a>";e.browser.webkit&&window.chrome&&(r+="&nbsp;"),this.execCommand("inserthtml",r),"function"==typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,n)}this.modalClose()},modalInit:function(t,n,i,r,o){0===e("#redactor_modal_overlay").size()&&(this.overlay=e('<div id="redactor_modal_overlay" style="display: none;"></div>'),e("body").prepend(this.overlay)),0===e("#redactor_modal").size()&&(this.modal=e('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),e("body").append(this.modal)),e("#redactor_modal_close").click(e.proxy(this.modalClose,this)),this.hdlModalClose=e.proxy(function(e){27===e.keyCode&&this.modalClose()},this),e(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),e("#redactor_modal_inner").html(this.opts["modal_"+n]),e("#redactor_modal_header").html(t),this.opts.overlay&&(e("#redactor_modal_overlay").show(),0!=e("#redactor_modal form").data("overlayEvent")&&e("#redactor_modal_overlay").click(e.proxy(this.modalClose,this))),0!==e("#redactor_tabs").size()&&e("#redactor_tabs a").each(function(t,i){t++,e(i).click(function(){e("#redactor_tabs a").removeClass("redactor_tabs_act"),e(this).addClass("redactor_tabs_act"),e(".redactor_tab").slideUp("fast"),e("#redactor_tab"+t).slideDown("fast"),"image"==n&&2>=t?e("#redactor_upload_btn").hide():e("#redactor_upload_btn").show(),"image"==n&&2==t?e("#redactor_image_choose_help_text").show():e("#redactor_image_choose_help_text").hide(),e("#redactor_tab_selected").val(t)})}),e("#redactor_btn_modal_close").click(e.proxy(this.modalClose,this)),"function"==typeof r&&r(),e("#redactor_modal").outerHeight(!0),this.isMobile()===!1?(e("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:i+"px",height:"auto",minHeight:"auto",marginTop:"-255px",marginLeft:"-"+(i+60)/2+"px"}).fadeIn("fast"),this.modalSaveBodyOveflow=this.modalSaveBodyOveflow||e(document.body).css("overflow"),e(document.body).css("overflow","hidden")):e("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof o&&o()},modalClose:function(){e("#redactor_modal_close").unbind("click",this.modalClose),e("#redactor_modal").fadeOut("fast",e.proxy(function(){e("#redactor_modal_inner").html(""),this.opts.overlay&&(e("#redactor_modal_overlay").hide(),e("#redactor_modal_overlay").unbind("click",this.modalClose)),e(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&(e(document.body).css("overflow",this.modalSaveBodyOveflow),this.modalSaveBodyOveflow=null)},setModalTab:function(t){e(".redactor_tab").hide();var n=e("#redactor_tabs a");n.removeClass("redactor_tabs_act"),n.eq(t-1).addClass("redactor_tabs_act"),e("#redactor_tab"+t).show()},uploadInit:function(t,n){this.uploadOptions={url:!1,success:!1,start:!1,trigger:!1,auto:!1,input:!1},e.extend(this.uploadOptions,n),0!==e("#"+t).size()&&"INPUT"===e("#"+t).get(0).tagName?(this.uploadOptions.input=e("#"+t),this.element=e(e("#"+t).get(0).form)):this.element=e("#"+t),this.element_action=this.element.attr("action"),this.uploadOptions.auto?e(this.uploadOptions.input).change(e.proxy(function(){this.element.submit(function(){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&e("#"+this.uploadOptions.trigger).click(e.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var t=document.createElement("div"),n='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';t.innerHTML=n,document.body.appendChild(t),this.uploadOptions.start&&this.uploadOptions.start();var i=this;return e("#"+this.id).load(function(){i.uploadLoaded.call(i,this)}),this.id},uploadForm:function(t,n){if(this.insertLoadingAtCaret(),this.uploadOptions.input){var i="redactorUploadForm"+this.id,r="redactorUploadFile"+this.id;this.form=e('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+n+'" name="'+i+'" id="'+i+'" enctype="multipart/form-data"></form>'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&e.each(this.opts.uploadFields,e.proxy(function(t,n){0===n.indexOf("#")&&(n=e(n).val());var i=e('<input type="hidden" name="'+t+'" value="'+n+'">');e(this.form).append(i)},this));var o=this.uploadOptions.input,s=e(o).clone(),a=e('<input type="hidden" name="_uniquekey" value="'+this.uniqueKey+'">');e(o).attr("id",r),e(o).before(s),e(o).appendTo(this.form),a.appendTo(this.form),e(this.form).css("position","absolute"),e(this.form).css("top","-2000px"),e(this.form).css("left","-2000px"),e(this.form).appendTo("body"),add_csrf_token(this.form),this.form.submit()}else t.attr("target",n),t.attr("method","POST"),t.attr("enctype","multipart/form-data"),t.attr("action",this.uploadOptions.url),add_csrf_token(t),this.element.submit()},insertLoadingAtCaret:function(){this.modalClose(),this.$editor.focus(),this.restoreSelection(),this.uniqueKey=(new Date).getTime(),this.focusOnCursor();var t=e('<img src="'+uploaded_img_placeholder+'" class="image-loader" id="uploading_images_'+this.uniqueKey+'">');this.insertNodeAtCaret(t.get(0)),"function"==typeof this.opts.imageLoadingCallback?this.opts.imageLoadingCallback(this):this.disableFormWhileLoadingImage()},disableFormWhileLoadingImage:function(){this.$editor.parents("form").find('input[type="submit"]:not(:disabled), input[type="button"]:not(:disabled), button:not(:disabled)').addClass("load-disable").prop("disabled",!0)},enableFormAfterLoadingImage:function(){this.$editor.parents("form").find(".load-disable").prop("disabled",!1)},uploadLoaded:function(t){var n=e(t).contents().find("body").get(0);if(this.uploadOptions.success)if("undefined"!=typeof n){var i=n.innerHTML,r=i.match(/\{.*\}/)[0];this.uploadOptions.success(r)}else alert("Upload failed!"),this.$editor.find("img.image-loader").remove(),"function"==typeof this.opts.imageLoadedCallback?this.opts.imageLoadedCallback(this):this.enableFormAfterLoadingImage(),this.uploadOptions.success(!1);this.element.attr("action",this.element_action),this.element.attr("target","")},browser:function(e){var t=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"version"==e?n[2]:"webkit"==e?"chrome"==n[1]||"webkit"==n[1]:n[1]==e},oldIE:function(){return e.browser.msie&&parseInt(e.browser.version,10)<9?!0:!1},outerHTML:function(t){return e("<p>").append(e(t).eq(0).clone()).html()},normalize:function(e){return parseInt(e.replace("px",""),10)},isMobile:function(e){return e===!0&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1},cleanUpRedundant:function(){var t=this;e.each(this.$editor.find("[rel=tempredactor]"),function(){_element=e(this),e.each(["li","ol","ul","h1","h2","h3","h4","h5","h6"],function(){_element.text()==e.trim(_element.parent().text())&&_element.parent().is(this.toString())&&_element.parent().replaceWith(_element)}),e(this).css("font-weight","normal"),e(this).removeAttr("rel")}),e.each(this.$editor.find("span"),function(){"temp_redactor_font_size"==e(this).attr("rel")?(e(this).find("span").css("font-size",""),e(this).removeAttr("rel")):"temp_redactor_font_family"==e(this).attr("rel")&&(e(this).find("span").css("font-family",""),e(this).removeAttr("rel"))}),e.each(this.$editor.find("span"),function(){e(this).text()==e(this).parent().text()&&e(this).parent().is("span")&&(parentstyle=e(this).parent().attr("style"),childstyle=e(this).attr("style"),e(this).parent().attr("style",parentstyle+";"+childstyle),e(this).replaceWith(e(this).html()))}),e.each(this.$editor.find("span"),function(){var n=this;e.each(t.opts.span_cleanup_properties,function(e,i){t.compareParentStyles(n,i)}),(e(this).css("background-color")==e(this).parent().css("background-color")||e(this).css("background-color")==t.$editor.css("background-color")&&"transparent"==e(this).parent().css("background-color"))&&e(this).css("background-color","")}),this.syncCode()},inputEventAvailable:function(){return e.browser.webkit||e.browser.mozilla},compareParentStyles:function(t,n){n=e.trim(n),e.trim(e(t).css(n))==e.trim(e(t).parent().css(n))&&e(t).css(n,"")},placeCaretAtEnd:function(){var e=this.$editor.get(0);if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var i=document.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}},insertHtmlAtLast:function(e){this.placeCaretAtEnd(),this.insertHtml(e)}},e.fn.getEditor=function(){return this.data("redactor").$editor},e.fn.getCode=function(){return this.data("redactor").getCode()},e.fn.getText=function(){return this.data("redactor").$editor.text()},e.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},e.fn.setCode=function(e){this.data("redactor").setCode(e)},e.fn.insertHtml=function(e){this.data("redactor").insertHtml(e)},e.fn.destroyEditor=function(){this.data("redactor").destroy(),this.removeData("redactor")},e.fn.setFocus=function(){this.data("redactor").$editor.focus()},e.fn.clearRichText=function(){var e=this.data("redactor");e.setCode(e.paragraphy(""))},e.fn.execCommand=function(e,t){this.data("redactor").execCommand(e,t)},e.fn.insertExternal=function(e){this.data("redactor").insertExternal(e)}}(jQuery),function(e){"use strict";function t(e){this.$editor=e,this.$form=this.$editor.$el.get(0).form}e.fn.removeCursorImage=function(){return this.each(function(){var e=new t(this);e.init()})},t.prototype={init:function(){jQuery(this.$form).on("submit",e.proxy(this.remove,this))},remove:function(){this.$editor.removeCursorImage()}}}(window.jQuery),function(e){"use strict";function t(t,n){this.opts=e.extend({class_name:"q-marker",template:"<div class='wrap-marker'></div>",tooltip_text:"Show quoted text"},n),this.$redactor=t,this.$redactor.$quoted=this,this.$quoted_area=e(this.$redactor.$el.data("quotedTextarea")),this.$marker=e("<span class='"+this.opts.class_name+" tooltip' title='"+this.opts.tooltip_text+"' />"),this.$template=e(this.opts.template).append(this.$marker),this.$form=this.$redactor.$el.get(0).form,this.$draft_added=!1}e.fn.quotedtext=function(e){return this.each(function(){var n=new t(this,e);n.init()})},t.prototype={init:function(){this.$template.insertAfter(this.$redactor.$editor),this.checkQuotedText(),jQuery(this.$form).on("submit.quotedtext",e.proxy(this.syncQuotedText,this)),jQuery(this.$redactor.$box).delegate("."+this.opts.class_name,"click.quotedtext",e.proxy(this.insertQuotedText,this))},insertQuotedText:function(){this.$redactor.insertHtmlAtLast(this.getQuotedText()),this.$redactor.syncCode(),this.checkQuotedText()},checkQuotedText:function(){this.$draft_added=this.$redactor.$editor.find(".freshdesk_quote").get(0)?!0:!1,this.$template.toggle(!this.$draft_added)},syncQuotedText:function(){if(!this.$draft_added){var e=this.$redactor.$el.val()+this.$quoted_area.val();this.$redactor.$el.val(e)}},getQuotedText:function(){return this.$quoted_area.val()+"<p><br /></p>"},reset:function(){this.$draft_added=!1},destroy:function(){this.$draft_added=!1,this.$template.remove(),jQuery(this.$form).off(".quotedtext"),jQuery(this.$redactor.$box).off(".quotedtext")}}}(window.jQuery),/*
	Plugin Drag and drop Upload v1.0.2
	http://imperavi.com/ 
	Copyright 2012, Imperavi Inc.
*/
function(e){"use strict";function t(t,n){this.opts=e.extend({url:!1,success:!1,preview:!1,uploadFields:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},n),this.$el=e(t)}e.fn.dragupload=function(e){return this.each(function(){var n=new t(this,e);n.init()})},t.prototype={init:function(){e.browser.msie||(this.droparea=e('<div class="redactor_droparea"></div>'),this.dropareabox=e('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.droparea.append(this.dropareabox),this.$el.parent().after(this.droparea),this.dropareabox.bind("dragover",e.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",e.proxy(function(){return this.ondragleave()},this)),this.dropareabox.get(0).ondrop=e.proxy(function(t){t.preventDefault(),this.opts.ondropCallback&&this.opts.ondropCallback(),this.dropareabox.removeClass("hover").addClass("drop");var n=t.dataTransfer.files[0];if(void 0!==n){var i=new FormData;this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&e.each(this.opts.uploadFields,e.proxy(function(t,n){"function"==typeof n?n=n():0===n.indexOf("#")&&(n=e(n).val()),i.append(t,n)},this)),i.append("image[uploaded_data]",n),e.ajax({dataType:"html",url:this.opts.url,data:i,cache:!1,contentType:!1,processData:!1,type:"POST",success:e.proxy(function(e){this.opts.success!==!1&&this.opts.success(e),this.opts.preview===!0&&this.dropareabox.html(e)},this),error:e.proxy(function(e){this.opts.error!==!1&&this.opts.error(e)},this)})}else this.opts.error('{"invalidFile": true}')},this))},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(e){"use strict";e.fn.linkify=function(){}}(jQuery),function(e){"use strict";function t(e,t){this.$editor=t,this.upload_url=this.$editor.opts.clipboardImageUpload,this.currentevent=e}jQuery.event.props.push("dataTransfer"),e.fn.pasteImage=function(e){return this.each(function(){var n=new t(e,this);n.init()})},t.prototype={init:function(){this.bindCustomEvent(),"paste"==this.currentevent.type?this.pasteContent():this.dropedContent()},pasteContent:function(){var t,n,i,r,o=this,s=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);if(s)return this.currentevent.preventDefault(),!1;if(null!=(null!=(n=this.currentevent.originalEvent)?n.clipboardData:void 0))if(t=this.currentevent.originalEvent.clipboardData,t.items){var a=t.items,l=a[0].getAsFile();o.loadImageFileAsURL(l)}else this.$editor.saveSelection(),this.$editor.insertLoadingAtCaret(),e('[rel="getPasteImage"]').focus(),setTimeout(function(){var t=e("<div />").html(e('[rel="getPasteImage"]').html()),n=t.find("img")[0];e('[rel="getPasteImage"]').html(""),o.$editor.$el.trigger("pasteImage",{dataURI:n.src,uniqueKey:o.$editor.uniqueKey})},500);if(t=window.clipboardData){var c=t.files;for(i=0,r=c.length;r>i;i++){var u=c[i];o.loadImageFileAsURL(u),o.currentevent.preventDefault()}}},dropedContent:function(){var t=this.currentevent.originalEvent.dataTransfer.files,n=this;void 0!=t&&t.length>0&&(n.currentevent.preventDefault(),e.each(t,function(e,t){n.loadImageFileAsURL(t)}))},loadImageFileAsURL:function(e){var t=this,n=new FileReader;n.onload=function(e){t.handleImage(e.target.result)},n.readAsDataURL(e)},handleImage:function(e){this.$editor.saveSelection(),this.$editor.insertLoadingAtCaret(),this.currentevent.preventDefault(),this.$editor.$el.trigger("pasteImage",{dataURI:e,uniqueKey:this.$editor.uniqueKey})},bindCustomEvent:function(){var e=this;this.$editor.$el.off(),this.$editor.$el.on("pasteImage",function(t,n){e.saveImage(n),t.preventDefault()})},saveImage:function(t){var n=this.$editor,i={dataURI:t.dataURI,_uniquekey:t.uniqueKey};e.ajax({dataType:"json",url:this.upload_url,data:i,type:"POST",success:e.proxy(function(e){e=JSON.stringify(e),n.imageUploadCallback(e)},this),error:e.proxy(function(e){console.log(e),e=JSON.stringify(e),n.imageUploadCallback(e)},this)})}}}(window.jQuery),function(e){e.event.special.textselect={setup:function(t){e(this).data("textselected",!1),e(this).data("ttt",t),e(this).bind("mouseup",e.event.special.textselect.handler)},teardown:function(){e(this).unbind("mouseup",e.event.special.textselect.handler)},handler:function(t){var n=e(this).data("ttt"),i=e.event.special.textselect.getSelectedText(n).toString();""!=i&&(e(this).data("textselected",!0),t.type="textselect",t.text=i,e.event.handle.apply(this,arguments))},getSelectedText:function(){var e="";return window.getSelection?e=window.getSelection():document.getSelection?e=document.getSelection():document.selection&&(e=document.selection.createRange().text),e}},e.event.special.textunselect={setup:function(t){e(this).data("rttt",t),e(this).data("textselected",!1),e(this).bind("mouseup",e.event.special.textunselect.handler),e(this).bind("keyup",e.event.special.textunselect.handlerKey)},teardown:function(){e(this).unbind("mouseup",e.event.special.textunselect.handler)},handler:function(t){if(e(this).data("textselected")){var n=e(this).data("rttt"),i=e.event.special.textselect.getSelectedText(n).toString();""==i&&(e(this).data("textselected",!1),t.type="textunselect",e.event.handle.apply(this,arguments))}},handlerKey:function(t){if(e(this).data("textselected")){var n=e(this).data("rttt"),i=e.event.special.textselect.getSelectedText(n).toString();(t.keyCode=27)&&""==i&&(e(this).data("textselected",!1),t.type="textunselect",e.event.handle.apply(this,arguments))}}}}(jQuery);